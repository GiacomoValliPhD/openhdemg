<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>openhdemg.library.plotemg &mdash; openhdemg 0.1.0-beta documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            openhdemg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">openhdemg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openhdemg.html">openhdemg package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openhdemg.library.html">openhdemg.library package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">openhdemg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">openhdemg.library.plotemg</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for openhdemg.library.plotemg</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains all the functions used to visualise the emg file,</span>
<span class="sd">the MUs properties or to save figures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">openhdemg.library.tools</span> <span class="kn">import</span> <span class="n">compute_idr</span>
<span class="kn">from</span> <span class="nn">openhdemg.library.mathtools</span> <span class="kn">import</span> <span class="n">min_max_scaling</span>


<div class="viewcode-block" id="showgoodlayout"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.showgoodlayout">[docs]</a><span class="k">def</span> <span class="nf">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Despine and show plots with a good layout.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If true (default), plt.tight_layout() is applied to the figure.</span>
<span class="sd">    despined : bool or str {&quot;2yaxes&quot;}, default False</span>
<span class="sd">        False: left and bottom is not despined (standard plotting).</span>
<span class="sd">        True: all the sides are despined.</span>
<span class="sd">        ``2yaxes``</span>
<span class="sd">            Only the top is despined.</span>
<span class="sd">            This is used to show y axes both on the right and left side at the</span>
<span class="sd">            same time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">despined</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">despined</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">despined</span> <span class="o">==</span> <span class="s2">&quot;2yaxes&quot;</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;despined can be True, False or 2yaxes. </span><span class="si">{</span><span class="n">despined</span><span class="si">}</span><span class="s2"> was passed instead&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">tight_layout</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_emgsig"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_emgsig">[docs]</a><span class="k">def</span> <span class="nf">plot_emgsig</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">channels</span><span class="p">,</span>
    <span class="n">addrefsig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the RAW_SIGNAL. Single or multiple channels.</span>

<span class="sd">    Up to 12 channels (a common matrix row) can be easily observed togheter</span>
<span class="sd">    but more can be plotted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    channels : int or list</span>
<span class="sd">        The channel (int) or channels (list of int) to plot.</span>
<span class="sd">        The list can be passed as a manually-written list or with:</span>
<span class="sd">        channels=[*range(0, 12)].</span>
<span class="sd">        We need the &quot;*&quot; operator to unpack the results of range into a list.</span>
<span class="sd">        channels is expected to be with base 0 (i.e., the first channel</span>
<span class="sd">        in the file is the number 0).</span>
<span class="sd">    addrefsig : bool, default True</span>
<span class="sd">        If True, the REF_SIGNAL is plotted in front of the signal with a</span>
<span class="sd">        separated y-axes.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    plot_differentials : plot the differential derivation of the RAW_SIGNAL by</span>
<span class="sd">        matrix column.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot channels 0 to 12 and overlay the reference signal.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_emgsig(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     channels=[*range(0,13)],</span>
<span class="sd">    ...     addrefsig=True,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check to have the RAW_SIGNAL in a pandas dataframe</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;RAW_SIGNAL&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">emgsig</span> <span class="o">=</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;RAW_SIGNAL&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;RAW_SIGNAL is probably absent or it is not contained in a dataframe&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Here we produce an x axis in seconds or samples</span>
    <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">emgsig</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">emgsig</span><span class="o">.</span><span class="n">index</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="s2">&quot;Channels n.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="n">figname</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Check if we have a single channel or a list of channels to plot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">emgsig</span><span class="p">[</span><span class="n">channels</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Ch </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channels</span><span class="p">))</span>
        <span class="c1"># set_ylabel is useful because if the channe is empty it won&#39;t</span>
        <span class="c1"># show the channel number</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Plot all the channels in the subplots</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">thisChannel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channels</span><span class="p">):</span>
            <span class="c1"># Normalise the series</span>
            <span class="n">norm_raw</span> <span class="o">=</span> <span class="n">min_max_scaling</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;RAW_SIGNAL&quot;</span><span class="p">][</span><span class="n">thisChannel</span><span class="p">])</span>
            <span class="c1"># Add 1 to the previous channel to avoid overlapping</span>
            <span class="n">norm_raw</span> <span class="o">=</span> <span class="n">norm_raw</span> <span class="o">+</span> <span class="n">count</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">norm_raw</span><span class="p">)</span>

        <span class="c1"># Ensure correct and complete ticks on the left y axis</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">))])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">])</span>
        <span class="c1"># Set axes labels</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Channels&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;While calling the plot_emgsig function, you should pass an integer, a list or &#39;all&#39; to channels&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="c1"># Plot the ref signal</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeinseconds</span>
            <span class="k">else</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.4&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MVC&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="s2">&quot;2yaxes&quot;</span> <span class="k">if</span> <span class="n">addrefsig</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_differentials"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_differentials">[docs]</a><span class="k">def</span> <span class="nf">plot_differentials</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">differential</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;col0&quot;</span><span class="p">,</span>
    <span class="n">addrefsig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the differential derivation of the RAW_SIGNAL by matrix column.</span>

<span class="sd">    Both the single and the double differencials can be plotted.</span>
<span class="sd">    This function is used to plot also the sorted RAW_SIGNAL.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the original emgfile.</span>
<span class="sd">    differential : dict</span>
<span class="sd">        The dictionary containing the differential derivation of the</span>
<span class="sd">        RAW_SIGNAL.</span>
<span class="sd">    column : str {&quot;col0&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;, &quot;col4&quot;, ...}, default &quot;col0&quot;</span>
<span class="sd">        The matrix column to plot.</span>
<span class="sd">        Options are usyally &quot;col0&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;, &quot;col4&quot;.</span>
<span class="sd">        but might change based on the size of the matrix used.</span>
<span class="sd">    addrefsig : bool, default True</span>
<span class="sd">        If True, the REF_SIGNAL is plotted in front of the signal with a</span>
<span class="sd">        separated y-axes.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    diff : calculate single differential of RAW_SIGNAL on matrix rows.</span>
<span class="sd">    double_diff : calculate double differential of RAW_SIGNAL on matrix rows.</span>
<span class="sd">    plot_emgsig : pot the RAW_SIGNAL. Single or multiple channels.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot plot the differential derivation of the first matrix column (col0).</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    &gt;&gt;&gt;     emgfile=emgfile,</span>
<span class="sd">    &gt;&gt;&gt;     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     orientation=180,</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; sd=emg.diff(sorted_rawemg=sorted_rawemg)</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_differentials(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     differential=sd,</span>
<span class="sd">    ...     column=&quot;col0&quot;,</span>
<span class="sd">    ...     addrefsig=False,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check to have the RAW_SIGNAL in a pandas dataframe</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">differential</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">emgsig</span> <span class="o">=</span> <span class="n">differential</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;RAW_SIGNAL is probably absent or it is not contained in a dataframe&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Here we produce an x axis in seconds or samples</span>
    <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">emgsig</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">emgsig</span><span class="o">.</span><span class="n">index</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="s2">&quot;Column n.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="n">figname</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Plot all the channels of every column in the subplots</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">thisChannel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">emgsig</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="c1"># Normalise the series</span>
        <span class="n">norm_raw</span> <span class="o">=</span> <span class="n">min_max_scaling</span><span class="p">(</span><span class="n">emgsig</span><span class="p">[</span><span class="n">thisChannel</span><span class="p">])</span>
        <span class="c1"># Add 1 to the previous channel to avoid overlapping</span>
        <span class="n">norm_raw</span> <span class="o">=</span> <span class="n">norm_raw</span> <span class="o">+</span> <span class="n">count</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">norm_raw</span><span class="p">)</span>

    <span class="c1"># Ensure correct and complete ticks on the left y axis</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emgsig</span><span class="o">.</span><span class="n">columns</span><span class="p">))])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">emgsig</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
    <span class="c1"># Set axes labels</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Channels&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="c1"># Plot the ref signal</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeinseconds</span>
            <span class="k">else</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.4&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MVC&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="s2">&quot;2yaxes&quot;</span> <span class="k">if</span> <span class="n">addrefsig</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_refsig"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_refsig">[docs]</a><span class="k">def</span> <span class="nf">plot_refsig</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;MVC&quot;</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the REF_SIGNAL.</span>

<span class="sd">    The REF_SIGNAL is usually expressed as % MVC for submaximal contractions</span>
<span class="sd">    or as Kilograms (Kg) or Newtons (N) for maximal contractions, but any</span>
<span class="sd">    value can be plotted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    ylabel : str, default &quot;MVC&quot;</span>
<span class="sd">        The unit of measure to show on the Y axis.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot the reference signal.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_refsig(emgfile=emgfile)</span>

<span class="sd">    Change Y axis label and show time in samples.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_refsig(</span>
<span class="sd">    &gt;&gt;&gt;     emgfile=emgfile,</span>
<span class="sd">    &gt;&gt;&gt;     ylabel=&quot;Custom unit e.g., N or kg&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     timeinseconds=False,</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check to have the REF_SIGNAL in a pandas dataframe</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">refsig</span> <span class="o">=</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span>

        <span class="c1"># Here we produce an x axis in seconds or samples</span>
        <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">refsig</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">refsig</span><span class="o">.</span><span class="n">index</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
            <span class="s2">&quot;Reference signal&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">refsig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

        <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;REF_SIGNAL is probably absent or it is not contained in a dataframe&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="plot_mupulses"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_mupulses">[docs]</a><span class="k">def</span> <span class="nf">plot_mupulses</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">munumber</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">addrefsig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot all the MUPULSES (binary representation of the firings time).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    munumber : str {&quot;all&quot;}, int or list, default &quot;all&quot;</span>
<span class="sd">        ``all``</span>
<span class="sd">            IPTS of all the MUs is plotted.</span>

<span class="sd">        Otherwise, a single MU (int) or multiple MUs (list of int) can be</span>
<span class="sd">        specified.</span>
<span class="sd">        The list can be passed as a manually-written list or with:</span>
<span class="sd">        munumber=[*range(0, 12)].</span>
<span class="sd">        We need the &quot;*&quot; operator to unpack the results of range into a list.</span>
<span class="sd">        munumber is expected to be with base 0 (i.e., the first MU in the file</span>
<span class="sd">        is the number 0).</span>
<span class="sd">    linewidths : float, default 0.5</span>
<span class="sd">        The width of the vertical lines representing the MU firing.</span>
<span class="sd">    addrefsig : bool, default True</span>
<span class="sd">        If True, the REF_SIGNAL is plotted in front of the MUs pulses with a</span>
<span class="sd">        separated y-axes.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    plot_ipts : plot the MUs impulse train per second (IPTS).</span>
<span class="sd">    plot_idr : plot the instantaneous discharge rate.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot MUs pulses based on recruitment order and overlay the reference</span>
<span class="sd">    signal.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_mupulses(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     linewidths=0.5,</span>
<span class="sd">    ...     order=True,</span>
<span class="sd">    ...     addrefsig=True,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check to have the correct input</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;MUPULSES&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">mupulses</span> <span class="o">=</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;MUPULSES&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;MUPULSES is probably absent or it is not contained in a np.array&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;REF_SIGNAL is probably absent or it is not contained in a dataframe&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Check if all the MUs have to be plotted and create the y labels</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Manage exception of single MU</span>
        <span class="k">if</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">y_tick_lab</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">])]</span>
            <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;MUs&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_tick_lab</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;MU n. 0&quot;</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">mupulses</span> <span class="o">=</span> <span class="p">[</span><span class="n">mupulses</span><span class="p">[</span><span class="n">munumber</span><span class="p">]]</span>
        <span class="n">y_tick_lab</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MU n. </span><span class="si">{</span><span class="n">munumber</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">mupulses</span> <span class="o">=</span> <span class="p">[</span><span class="n">mupulses</span><span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">munumber</span><span class="p">]</span>
        <span class="n">y_tick_lab</span> <span class="o">=</span> <span class="n">munumber</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;MUs&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;While calling the plot_mupulses function, you should pass an integer, a list or &#39;all&#39; to munumber&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Convert x axes in seconds if timeinseconds==True.</span>
    <span class="c1"># This has to be done both for the REF_SIGNAL and the mupulses, for the</span>
    <span class="c1"># MUPULSES we need to convert the point of firing from samples to seconds.</span>
    <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
        <span class="n">mupulses</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">mupulses</span><span class="p">]</span>

    <span class="c1"># Create colors list for the firings and plot them</span>
    <span class="n">colors1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mupulses</span><span class="p">))]</span>

    <span class="c1"># Use the subplot to allow the use of twinx</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="s2">&quot;MUs pulses&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Plot the MUPULSES.</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">eventplot</span><span class="p">(</span>
        <span class="n">mupulses</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
        <span class="n">linelengths</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>  <span class="c1"># Assign 90% of the space in the plot to linelengths</span>
        <span class="n">lineoffsets</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Ensure correct and complete ticks on the left y axis</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mupulses</span><span class="p">))])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">y_tick_lab</span><span class="p">])</span>
    <span class="c1"># Set axes labels</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="c1"># Create the second (right) y axes</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="c1"># Plot REF_SIGNAL on the right y axes</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeinseconds</span>
            <span class="k">else</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.4&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MVC&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="s2">&quot;2yaxes&quot;</span> <span class="k">if</span> <span class="n">addrefsig</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_ipts"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_ipts">[docs]</a><span class="k">def</span> <span class="nf">plot_ipts</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">munumber</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">addrefsig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the IPTS (source of decomposition).</span>

<span class="sd">    IPTS is the non-binary representation of the MUs firing times.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    munumber : str {&quot;all&quot;}, int or list, default &quot;all&quot;</span>
<span class="sd">        ``all``</span>
<span class="sd">            IPTS of all the MUs is plotted.</span>

<span class="sd">        Otherwise, a single MU (int) or multiple MUs (list of int) can be</span>
<span class="sd">        specified.</span>
<span class="sd">        The list can be passed as a manually-written list or with:</span>
<span class="sd">        munumber=[*range(0, 12)].</span>
<span class="sd">        We need the &quot;*&quot; operator to unpack the results of range into a list.</span>
<span class="sd">        munumber is expected to be with base 0 (i.e., the first MU in the file</span>
<span class="sd">        is the number 0).</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    plot_mupulses : plot the binary representation of the firings.</span>
<span class="sd">    plot_idr : plot the instantaneous discharge rate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    munumber = &quot;all&quot; corresponds to:</span>
<span class="sd">    munumber = [*range(0, emgfile[&quot;NUMBER_OF_MUS&quot;])]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot IPTS of all the MUs and overlay the reference signal.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_ipts(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     munumber=&quot;all&quot;,</span>
<span class="sd">    ...     addrefsig=True,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>

<span class="sd">    Plot IPTS of two MUs.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_ipts(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     munumber=[1, 3],</span>
<span class="sd">    ...     addrefsig=False,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if all the MUs have to be plotted</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Manage exception of single MU</span>
            <span class="n">munumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">munumber</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">])]</span>

    <span class="c1"># Check to have the IPTS in a pandas dataframe</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;IPTS&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">ipts</span> <span class="o">=</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;IPTS&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;IPTS is probably absent or it is not contained in a dataframe&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Here we produce an x axis in seconds or samples</span>
    <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">ipts</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">ipts</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># Use the subplot function to allow for the use of twinx()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="s2">&quot;IPTS&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Check if we have a single MU or a list of MUs to plot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ipts</span><span class="p">[</span><span class="n">munumber</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MU </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">munumber</span><span class="p">))</span>
        <span class="c1"># Use set_ylabel because if the MU is empty,</span>
        <span class="c1"># the channel number won&#39;t show.</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Plot all the MUs.</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">thisMU</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">munumber</span><span class="p">):</span>
            <span class="n">norm_ipts</span> <span class="o">=</span> <span class="n">min_max_scaling</span><span class="p">(</span><span class="n">ipts</span><span class="p">[</span><span class="n">thisMU</span><span class="p">])</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="n">norm_ipts</span> <span class="o">+</span> <span class="n">count</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_axis</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

            <span class="c1"># Ensure correct and complete ticks on the left y axis</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">munumber</span><span class="p">))])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">munumber</span><span class="p">])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Motor units&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;While calling the plot_ipts function, you should pass an integer, a list or &#39;all&#39; to munumber&quot;</span>
        <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="c1"># Plot the ref signal</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeinseconds</span>
            <span class="k">else</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.4&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MVC&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="s2">&quot;2yaxes&quot;</span> <span class="k">if</span> <span class="n">addrefsig</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_idr"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_idr">[docs]</a><span class="k">def</span> <span class="nf">plot_idr</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">munumber</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">addrefsig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the instantaneous discharge rate (IDR).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    munumber : str, int or list, default &quot;all&quot;</span>
<span class="sd">        ``all&quot;</span>
<span class="sd">            IDR of all the MUs is plotted.</span>

<span class="sd">        Otherwise, a single MU (int) or multiple MUs (list of int) can be</span>
<span class="sd">        specified.</span>
<span class="sd">        The list can be passed as a manually-written list or with:</span>
<span class="sd">        munumber=[*range(0, 12)].</span>
<span class="sd">        We need the &quot;*&quot; operator to unpack the results of range into a list.</span>
<span class="sd">        munumber is expected to be with base 0 (i.e., the first MU in the file</span>
<span class="sd">        is the number 0).</span>
<span class="sd">    addrefsig : bool, default True</span>
<span class="sd">        If True, the REF_SIGNAL is plotted in front of the MUs IDR with a</span>
<span class="sd">        separated y-axes.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    plot_mupulses : plot the binary representation of the firings.</span>
<span class="sd">    plot_ipts : plot the impulse train per second (IPTS).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    munumber = &quot;all&quot; corresponds to</span>
<span class="sd">    munumber = [*range(0, emgfile[&quot;NUMBER_OF_MUS&quot;])]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot IDR of all the MUs and overlay the reference signal.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_idr(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     munumber=&quot;all&quot;,</span>
<span class="sd">    ...     addrefsig=True,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>

<span class="sd">    Plot IDR of two MUs.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;, # TODO change file and names</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_idr(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     munumber=[1, 3],</span>
<span class="sd">    ...     addrefsig=False,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute the IDR</span>
    <span class="n">idr</span> <span class="o">=</span> <span class="n">compute_idr</span><span class="p">(</span><span class="n">emgfile</span><span class="o">=</span><span class="n">emgfile</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;REF_SIGNAL is probably absent or it is not contained in a dataframe&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Check if all the MUs have to be plotted</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Manage exception of single MU</span>
            <span class="n">munumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">munumber</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">])]</span>

    <span class="c1"># Use the subplot function to allow for the use of twinx()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="s2">&quot;IDR&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Check if we have a single MU or a list of MUs to plot.</span>
    <span class="c1"># In the first case, the use of plt.figure has been preferred to</span>
    <span class="c1"># plt.subplots for the implementation of the MUs cleaning.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">idr</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="s2">&quot;timesec&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;mupulses&quot;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">idr</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="s2">&quot;idr&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
            <span class="s2">&quot;MU </span><span class="si">{}</span><span class="s2"> (pps)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">munumber</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># Useful because if the MU is empty it won&#39;t show the channel number</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">munumber</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">thisMU</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">munumber</span><span class="p">):</span>
            <span class="c1"># Normalise the series</span>
            <span class="n">norm_idr</span> <span class="o">=</span> <span class="n">min_max_scaling</span><span class="p">(</span><span class="n">idr</span><span class="p">[</span><span class="n">thisMU</span><span class="p">][</span><span class="s2">&quot;idr&quot;</span><span class="p">])</span>
            <span class="c1"># Add 1 to the previous MUs to avoid overlapping of the MUs</span>
            <span class="n">norm_idr</span> <span class="o">=</span> <span class="n">norm_idr</span> <span class="o">+</span> <span class="n">count</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">idr</span><span class="p">[</span><span class="n">thisMU</span><span class="p">][</span><span class="s2">&quot;timesec&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;mupulses&quot;</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">norm_idr</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Ensure correct and complete ticks on the left y axis</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">munumber</span><span class="p">))])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">munumber</span><span class="p">])</span>
        <span class="c1"># Set axes labels</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Motor units&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (Sec)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;While calling the plot_idr function, you should pass an integer, a list or &#39;all&#39; to munumber&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">addrefsig</span><span class="p">:</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="c1"># Plot the ref signal</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeinseconds</span>
            <span class="k">else</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;REF_SIGNAL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.4&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MVC&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="s2">&quot;2yaxes&quot;</span> <span class="k">if</span> <span class="n">addrefsig</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<span class="c1"># TODO_NEXT_kwargs for flexible plotting design (all the plots)</span>
<div class="viewcode-block" id="plot_muaps"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_muaps">[docs]</a><span class="k">def</span> <span class="nf">plot_muaps</span><span class="p">(</span>
    <span class="n">sta_dict</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MUAPs from STA&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot MUAPs obtained from STA from one or multiple MUs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sta_dict : dict or list</span>
<span class="sd">        dict containing STA of the specified MU or a list of dicts containing</span>
<span class="sd">        STA of specified MUs.</span>
<span class="sd">        If a list is passed, different MUs are overlayed. This is useful for</span>
<span class="sd">        visualisation of MUAPs during tracking or duplicates removal.</span>
<span class="sd">    tile : str, default &quot;MUAPs from STA&quot;</span>
<span class="sd">        Title of the plot.</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    sta : computes the spike-triggered average (STA) of every MUs.</span>
<span class="sd">    plot_muap : for overplotting all the STAs and the average STA of a MU.</span>
<span class="sd">    align_by_xcorr : for alignin the STAs of two different MUs.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    There is no limit to the number of MUs and STA files that can be</span>
<span class="sd">    overplotted.</span>
<span class="sd">    ``Remember: the different STAs should be matched`` with same number of</span>
<span class="sd">        electrode, processing (i.e., differential) and computed on the same</span>
<span class="sd">        timewindow.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot MUAPs of a single MU.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sta = emg.sta(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     firings=&quot;all&quot;,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muaps(sta_dict=sta[1])</span>

<span class="sd">    Plot single differential derivation MUAPs of a single MU.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.diff(sorted_rawemg=sorted_rawemg)</span>
<span class="sd">    &gt;&gt;&gt; sta = emg.sta(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     firings=&quot;all&quot;,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muaps(sta_dict=sta[1])</span>

<span class="sd">    Plot single differential derivation MUAPs of two MUs from the same file.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.diff(sorted_rawemg=sorted_rawemg)</span>
<span class="sd">    &gt;&gt;&gt; sta = emg.sta(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     firings=&quot;all&quot;,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muaps(sta_dict=[sta[1], sta[2]])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">sta_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">sta_dict</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Find the largest and smallest value to define y axis limits.</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Loop each sta_dict and MU, c means matrix columns</span>
        <span class="k">for</span> <span class="n">thisdict</span> <span class="ow">in</span> <span class="n">sta_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">thisdict</span><span class="p">:</span>
                <span class="n">max_</span> <span class="o">=</span> <span class="n">thisdict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">min_</span> <span class="o">=</span> <span class="n">thisdict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">max_</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">:</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">max_</span>
                <span class="k">if</span> <span class="n">min_</span> <span class="o">&lt;</span> <span class="n">xmin</span><span class="p">:</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">min_</span>

        <span class="c1"># Obtain number of columns and rows, this changes if we use</span>
        <span class="c1"># differential derivations</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;col0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">rows</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
            <span class="n">num</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">thisdict</span> <span class="ow">in</span> <span class="n">sta_dict</span><span class="p">:</span>
            <span class="c1"># Plot all the MUAPs, c means matrix columns, r rows</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thisdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thisdict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">r</span><span class="p">])</span>

                    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yticklabels</span><span class="o">=</span><span class="p">[])</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;sta_dict must be dict or list&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_muap"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_muap">[docs]</a><span class="k">def</span> <span class="nf">plot_muap</span><span class="p">(</span>
    <span class="n">emgfile</span><span class="p">,</span>
    <span class="n">stmuap</span><span class="p">,</span>
    <span class="n">munumber</span><span class="p">,</span>
    <span class="n">column</span><span class="p">,</span>
    <span class="n">channel</span><span class="p">,</span>
    <span class="n">channelprog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">timeinseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the MUAPs of a specific matrix channel.</span>

<span class="sd">    Plot the MUs action potential (MUAPs) shapes with or without average.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emgfile : dict</span>
<span class="sd">        The dictionary containing the emgfile.</span>
<span class="sd">    stmuap : dict</span>
<span class="sd">        dict containing a dict of ST MUAPs (pd.DataFrame) for every MUs.</span>
<span class="sd">    munumber : int</span>
<span class="sd">        The number of the MU to plot.</span>
<span class="sd">    column : str</span>
<span class="sd">        The matrix columns.</span>
<span class="sd">        Options are usyally &quot;col0&quot;, &quot;col1&quot;, &quot;col2&quot;, ..., last column.</span>
<span class="sd">    channel : int</span>
<span class="sd">        The channel of the matrix to plot.</span>
<span class="sd">        This can be the real channel number if channelprog=False (default),</span>
<span class="sd">        or a progressive number (from 0 to the length of the matrix column)</span>
<span class="sd">        if channelprog=True.</span>
<span class="sd">    channelprog : bool, default False</span>
<span class="sd">        Whether to use the real channel number or a progressive number</span>
<span class="sd">        (see channel).</span>
<span class="sd">    average : bool, default True</span>
<span class="sd">        Whether to plot also the MUAPs average obtained by spike triggered</span>
<span class="sd">        average.</span>
<span class="sd">    timeinseconds : bool, default True</span>
<span class="sd">        Whether to show the time on the x-axes in seconds (True)</span>
<span class="sd">        or in samples (False).</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>
<span class="sd">    tight_layout : bool, default True</span>
<span class="sd">        If True (default), the plt.tight_layout() is called and the figure&#39;s</span>
<span class="sd">        layout is improved.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    plot_muaps : Plot MUAPs obtained from STA from one or multiple MUs.</span>
<span class="sd">    st_muap : Generate spike triggered MUAPs of every MUs</span>
<span class="sd">        (as input to this function).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot all the consecutive MUAPs of a single MU.</span>
<span class="sd">    In this case we are plotting the matrix channel 45 which is placed in</span>
<span class="sd">    column 4 (&quot;col3&quot;) as Python numbering is base 0.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; stmuap = emg.st_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     stmuap=stmuap,</span>
<span class="sd">    ...     munumber=1,</span>
<span class="sd">    ...     column=&quot;col3&quot;,</span>
<span class="sd">    ...     channel=45,</span>
<span class="sd">    ...     channelprog=False,</span>
<span class="sd">    ...     average=False,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>

<span class="sd">    To avoid the problem of remebering which channel number is present in</span>
<span class="sd">    which matrix column, we can set channelprog=True and locate the channel</span>
<span class="sd">    with a value ranging from 0 to the length of each column.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; stmuap = emg.st_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     stmuap=stmuap,</span>
<span class="sd">    ...     munumber=1,</span>
<span class="sd">    ...     column=&quot;col3&quot;,</span>
<span class="sd">    ...     channel=5,</span>
<span class="sd">    ...     channelprog=True,</span>
<span class="sd">    ...     average=False,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>

<span class="sd">    It is also possible to visualise the spike triggered average</span>
<span class="sd">    of the MU with average=True.</span>
<span class="sd">    In this example the single differential derivation is used.</span>

<span class="sd">    .. plot::</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.emg_from_otb(</span>
<span class="sd">    ...     filepath=&quot;openhdemg/Decomposed Test files/OTB_25MViF_TRAPEZOIDAL_testfile.mat&quot;,</span>
<span class="sd">    ...     ext_factor=8</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.diff(sorted_rawemg=sorted_rawemg)</span>
<span class="sd">    &gt;&gt;&gt; stmuap = emg.st_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=sorted_rawemg,</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; emg.plot_muap(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     stmuap=stmuap,</span>
<span class="sd">    ...     munumber=1,</span>
<span class="sd">    ...     column=&quot;col2&quot;,</span>
<span class="sd">    ...     channel=6,</span>
<span class="sd">    ...     channelprog=True,</span>
<span class="sd">    ...     average=True,</span>
<span class="sd">    ...     timeinseconds=True,</span>
<span class="sd">    ...     figsize=[20, 15],</span>
<span class="sd">    ...     showimmediately=True,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if munumber is within the number of MUs</span>
    <span class="k">if</span> <span class="n">munumber</span> <span class="o">&gt;=</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;munumber exceeds the the number of MUs in the emgfile (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;NUMBER_OF_MUS&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Get the MUAPs to plot</span>
    <span class="k">if</span> <span class="n">channelprog</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stmuap</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Check that the specified channel is within the matrix column range</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Channel exceeds the the length of the matrix column, verify the use of channelprog&quot;</span>
            <span class="p">)</span>

        <span class="n">my_muap</span> <span class="o">=</span> <span class="n">stmuap</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">keys</span><span class="p">[</span><span class="n">channel</span><span class="p">]]</span>
        <span class="n">channelnumb</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stmuap</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Check that the specified channel is within the matrix channels</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Channel is not included in this matrix column, please check&quot;</span>
            <span class="p">)</span>

        <span class="n">my_muap</span> <span class="o">=</span> <span class="n">stmuap</span><span class="p">[</span><span class="n">munumber</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">channel</span><span class="p">]</span>
        <span class="n">channelnumb</span> <span class="o">=</span> <span class="n">channel</span>

    <span class="c1"># Here we produce an x axis in milliseconds or samples</span>
    <span class="k">if</span> <span class="n">timeinseconds</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">my_muap</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">emgfile</span><span class="p">[</span><span class="s2">&quot;FSAMP&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">my_muap</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># Set figure and name based on original channel number</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s2">&quot;ST MUAPs of MU </span><span class="si">{}</span><span class="s2">, column </span><span class="si">{}</span><span class="s2">, channel </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">munumber</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">channelnumb</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="n">figname</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Plot all the MUAPs</span>
    <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">my_muap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.6&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">my_muap</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">my_muap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ms)&quot;</span> <span class="k">if</span> <span class="n">timeinseconds</span> <span class="k">else</span> <span class="s2">&quot;Samples&quot;</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_muaps_for_cv"><a class="viewcode-back" href="../../../openhdemg.library.html#openhdemg.library.plotemg.plot_muaps_for_cv">[docs]</a><span class="k">def</span> <span class="nf">plot_muaps_for_cv</span><span class="p">(</span>
    <span class="n">sta_dict</span><span class="p">,</span>
    <span class="n">xcc_sta_dict</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MUAPs for CV&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="n">showimmediately</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualise MUAPs on which to calculate MUs CV.</span>

<span class="sd">    Plot MUAPs obtained from the STA of the double differential signal and</span>
<span class="sd">    their paired cross-correlation value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sta_dict : dict</span>
<span class="sd">        dict containing the STA of the double-differential derivation of a</span>
<span class="sd">        specific MU.</span>
<span class="sd">    xcc_sta_dict : dict</span>
<span class="sd">        dict containing the normalised cross-correlation coefficient of the</span>
<span class="sd">        double-differential derivation of a specific MU.</span>
<span class="sd">    tile : str, default &quot;MUAPs from STA&quot;</span>
<span class="sd">        Title of the plot.</span>
<span class="sd">    figsize : list, default [20, 15]</span>
<span class="sd">        Size of the figure in centimeters [width, height].</span>
<span class="sd">    showimmediately : bool, default True</span>
<span class="sd">        If True (default), plt.show() is called and the figure showed to the</span>
<span class="sd">        user.</span>
<span class="sd">        It is useful to set it to False when calling the function from the GUI.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : pyplot `~.figure.Figure`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot the double differential derivation and the XCC of adjacent channels</span>
<span class="sd">    for the first MU (0).</span>

<span class="sd">    &gt;&gt;&gt; import openhdemg as emg</span>
<span class="sd">    &gt;&gt;&gt; emgfile = emg.askopenfile(filesource=&quot;OTB&quot;, otb_ext_factor=8)</span>
<span class="sd">    &gt;&gt;&gt; sorted_rawemg = emg.sort_rawemg(</span>
<span class="sd">    ...     emgfile,</span>
<span class="sd">    ...     code=&quot;GR08MM1305&quot;,</span>
<span class="sd">    ...     orientation=180,</span>
<span class="sd">    ...     dividebycolumn=True</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; dd = emg.double_diff(sorted_rawemg)</span>
<span class="sd">    &gt;&gt;&gt; sta = emg.sta(</span>
<span class="sd">    ...     emgfile=emgfile,</span>
<span class="sd">    ...     sorted_rawemg=dd,</span>
<span class="sd">    ...     firings=[0, 50],</span>
<span class="sd">    ...     timewindow=50,</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; xcc_sta = emg.xcc_sta(sta)</span>
<span class="sd">    &gt;&gt;&gt; fig = emg.plot_muaps_for_cv(</span>
<span class="sd">    ...     sta_dict=sta[0],</span>
<span class="sd">    ...     xcc_sta_dict=xcc_sta[0],</span>
<span class="sd">    ...     showimmediately=False,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;sta_dict must be a dict&quot;</span><span class="p">)</span>

    <span class="c1"># Find the largest and smallest value to define y axis limits.</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Loop each column (c)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sta_dict</span><span class="p">:</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">sta_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">sta_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">max_</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">max_</span>
        <span class="k">if</span> <span class="n">min_</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">min_</span>

    <span class="c1"># Obtain number of columns and rows, this changes if we use different</span>
    <span class="c1"># matrices.</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">[</span><span class="s2">&quot;col0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">rows</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.54</span><span class="p">),</span>
        <span class="n">num</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Plot all the MUAPs, c means matrix columns, r rows</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sta_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sta_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">r</span><span class="p">])</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yticklabels</span><span class="o">=</span><span class="p">[])</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xcc</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xcc_sta_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">r</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">xcc</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span> <span class="k">if</span> <span class="n">xcc</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">3</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">showgoodlayout</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">despined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showimmediately</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Giacomo Valli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>